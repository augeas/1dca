<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <marimo-mode data-mode='read' hidden></marimo-mode>
    <marimo-version data-version='0.13.2' hidden></marimo-version>
    <marimo-user-config data-config='{"completion": {"activate_on_typing": true, "copilot": false}, "display": {"theme": "light", "code_editor_font_size": 14, "cell_output": "above", "default_width": "medium", "dataframes": "rich", "default_table_page_size": 10}, "formatting": {"line_length": 79}, "keymap": {"preset": "default", "overrides": {}}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "reactive_tests": true, "on_cell_change": "autorun", "watcher_on_save": "lazy", "output_max_bytes": 8000000, "std_stream_max_bytes": 1000000}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "package_management": {"manager": "pip"}, "server": {"browser": "default", "follow_symlink": false}, "language_servers": {"pylsp": {"enabled": true, "enable_mypy": true, "enable_ruff": true, "enable_flake8": false, "enable_pydocstyle": false, "enable_pylint": false, "enable_pyflakes": false}}, "snippets": {"custom_paths": [], "include_default_snippets": true}}' data-overrides='{}' hidden></marimo-user-config>
    <marimo-app-config data-config='{"width": "medium", "sql_output": "auto"}' hidden></marimo-app-config>
    <marimo-server-token data-token='123' hidden></marimo-server-token>
    <title>ca</title>
    <script type="module" crossorigin src="./assets/index-CBYlZPe-.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-DQ-mLFwY.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    
    <style>
        #save-button {
            display: none !important;
        }
        #filename-input {
            display: none !important;
        }
    </style>
    <marimo-code hidden="" data-show-code="false">import%20marimo%0A%0A__generated_with%20%3D%20%220.13.2%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%23%23Take%20Your%20Brain%20to%20the%201st%20Dimension%0A%20%20%20%20%20%20%20%20%23%23%23(In%20which%20we%20piss%20about%20with%20reasonably%20elementary%20One-Dimensional%20Cellular%20Automata.)%0A%0A%20%20%20%20%20%20%20%20Consider%20a%201-dimensional%20strip%20of%20cells%20that%20can%20be%20in%20two%20states%2C%20live%20or%20dead%2C%20on%20or%20off.%20The%20new%20state%20of%20a%20cell%20is%20determined%20by%20its%20current%20state%20and%20those%20of%20its%20neighbours%2C%20with%20evolution%20in%20time%20represented%20by%20filling%20in%20sucessive%20rows%20down%20a%20grid.%20Typically%2C%20the%20central%20cell%20at%20the%20top%20of%20the%20grid%20is%20seeded%20as%20live.%20If%20only%20the%20left%2C%20(%60l%60)%20centre%20(%60c%60)%20and%20right%20(%60r%60)%20cells%20are%20considered%20there%20are%20%242%5E%7B3%7D%3D8%24%20combinations%20of%20states%2C%20and%20%242%5E%7B8%7D%3D256%24%20possible%20rules.%20These%20are%20%5Belementary%20cellular%20automata%5D(https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FElementary_cellular_automaton).%20If%20the%20three%20states%20are%20considered%20as%20bits%20of%20the%20integers%200-7%2C%20the%20new%20state%20for%20each%20combination%20can%20be%20represented%20by%20an%208-bit%20integer%2C%20a%20scheme%20attributed%20to%20%5BWolfram%5D(https%3A%2F%2Ftinyurl.com%2Fwolframsacrank).%20If%20next-nearest%20neighbours%20are%20considered%2C%20left-of-left%20(%60L%60)%20and%20right-of-right%20(%60R%60)%2C%20there%20are%20%242%5E%7B5%7D%3D32%24%20combinations%20of%20states%2C%20and%20%242%5E%7B32%7D%3D4294967296%24%20rules.%20An%20exhaustive%20search%20for%20the%20suposedly%20interesting%20ones%20would%20be%20rather%20tedious.%20%5BToffoli%20and%20Margolus%5D(https%3A%2F%2Fpeople.csail.mit.edu%2Fnhm%2Fcam-book.pdf)%20developed%20dedicated%20hardware%20that%20enabled%20the%20programatic%20generation%20of%20rules%20in%20%5BForth%5D(https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FForth_(programming_language)).%20Somewhat%20inspired%20by%20this%2C%20here%20rules%20can%20be%20specified%20with%20simple%20(mostly)%20boolean%20expressions%20with%20an%20additional%20if-then-else%20function.%20(Done%20by%20converting%20the%20infix%20expression%20to%20%5Breverse-Polish%5D(https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FReverse_Polish_notation)%20with%20a%20cheap%20implementation%20of%20the%20%5Bshunting%20algortithm%5D(https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FShunting_yard_algorithm).%20A%20look-up-table%20is%20then%20generated%20for%20all%20combinations%20of%20states.)%20If%20the%20previous%20state%20of%20the%20central%20cell%20(%60p%60)%20is%20considered%2C%20there%20are%20%242%5E%7B2%5E%7B6%7D%7D%24%20rules%2C%20which%20is%20really%20rather%20a%20lot.%20By%20treating%20the%20previous%20states%20of%20each%20cell%20as%20a%20binary%20value%2C%20with%20the%20most%20recent%20value%20as%20the%20most-significant-bit%2C%20the%20cells%20can%20be%20coloured.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20return%20(mo%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20from%20functools%20import%20partial%2C%20reduce%0A%20%20%20%20import%20string%0A%0A%20%20%20%20from%20matplotlib%20import%20colormaps%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20from%20PIL%20import%20Image%0A%20%20%20%20return%20Image%2C%20colormaps%2C%20np%2C%20partial%2C%20reduce%2C%20string%0A%0A%0A%40app.cell%0Adef%20_(np)%3A%0A%20%20%20%20__var_tokens__%20%3D%20'pLlcrR'%0A%20%20%20%20__operators__%20%3D%20%7B%0A%20%20%20%20%20%20%20%20'*'%3A%202%2C%20'%25'%3A%202%2C%0A%20%20%20%20%20%20%20%20'%2B'%3A%201%2C%20'-'%3A%201%2C%0A%20%20%20%20%20%20%20%20'%26'%3A%200%2C%20'%7C'%3A%200%2C%20'%5E'%3A%200%2C%20'~'%3A%200%2C%20'%3D'%3A%200%2C%20'%3C'%3A%200%2C%20'%3E'%3A%200%0A%20%20%20%20%7D%0A%20%20%20%20__op_tokens__%20%3D%20''.join(__operators__.keys())%0A%0A%20%20%20%20__op_funcs__%20%3D%20%7B%0A%20%20%20%20%20%20%20%20'*'%3A%20np.multiply%2C%20'%25'%3A%20np.mod%2C%0A%20%20%20%20%20%20%20%20'%2B'%3A%20np.add%2C%20'-'%3A%20np.subtract%2C%0A%20%20%20%20%20%20%20%20'%26'%3A%20np.logical_and%2C%20'%7C'%3A%20np.logical_or%2C%0A%20%20%20%20%20%20%20%20'%5E'%3A%20np.logical_xor%2C%20'~'%3A%20np.logical_not%2C%0A%20%20%20%20%20%20%20%20'%3D'%3A%20np.equal%2C%0A%20%20%20%20%20%20%20%20'%3C'%3A%20np.less%2C%20'%3E'%3A%20np.greater%0A%20%20%20%20%7D%0A%0A%20%20%20%20__func_tokens__%20%3D%20'%3F'%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20__func_tokens__%2C%0A%20%20%20%20%20%20%20%20__op_funcs__%2C%0A%20%20%20%20%20%20%20%20__op_tokens__%2C%0A%20%20%20%20%20%20%20%20__operators__%2C%0A%20%20%20%20%20%20%20%20__var_tokens__%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell%0Adef%20_(__func_tokens__%2C%20__op_tokens__%2C%20__operators__%2C%20__var_tokens__%2C%20string)%3A%0A%20%20%20%20def%20shunt(expr)%3A%0A%20%20%20%20%20%20%20%20out_stack%20%3D%20list()%0A%20%20%20%20%20%20%20%20op_stack%20%3D%20list()%0A%20%20%20%20%20%20%20%20for%20i%2C%20tok%20in%20enumerate(expr)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20tok%20in%20string.digits%20or%20tok%20in%20__var_tokens__%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20out_stack.append((tok%2C%20i))%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20tok%20%3D%3D%20'('%20or%20tok%20in%20__func_tokens__%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op_stack.append((tok%2C%20i))%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20tok%20in%20__op_tokens__%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20priority%20%3D%20__operators__%5Btok%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20len(op_stack)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20__operators__.get(op_stack%5B-1%5D%5B0%5D%2C%20-1)%20%3E%20priority%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20out_stack.append(op_stack.pop())%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op_stack.append((tok%2C%20i))%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20tok%20%3D%3D%20')'%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20not%20len(op_stack)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20i%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20op_stack%5B-1%5D%5B0%5D%20!%3D%20'('%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20out_stack.append(op_stack.pop())%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20except%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20(%5B%5D%2C%20i)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20op_stack.pop()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20len(op_stack)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20op_stack%5B-1%5D%5B0%5D%20in%20__func_tokens__%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20out_stack.append(op_stack.pop())%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20tok%20%3D%3D%20'%2C'%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20len(op_stack)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20op_stack%5B-1%5D%5B0%5D%20!%3D%20'('%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20out_stack.append(op_stack.pop())%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20except%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20(%5B%5D%2C%20i)%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20(%5B%5D%2C%20i)%0A%20%20%20%20%20%20%20%20while%20len(op_stack)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20out_stack.append(op_stack.pop())%0A%20%20%20%20%20%20%20%20return%20(out_stack%2C%20None)%0A%20%20%20%20return%20(shunt%2C)%0A%0A%0A%40app.cell%0Adef%20_(__op_funcs__%2C%20__op_tokens__%2C%20__var_tokens__%2C%20np%2C%20string)%3A%0A%20%20%20%20def%20rp_eval(expr%2C%20pos%2C%20vars)%3A%0A%20%20%20%20%20%20%20%20stack%20%3D%20list()%0A%20%20%20%20%20%20%20%20for%20i%2C%20tok%20in%20enumerate(expr)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20tok%20in%20string.digits%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20stack.append(np.int32(tok))%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20tok%20in%20__var_tokens__%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20stack.append(vars%5Btok%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20tok%20in%20__op_tokens__%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20func%20%3D%20__op_funcs__%5Btok%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20tok%20%3D%3D%20'~'%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20args%20%3D%20%5Bstack.pop()%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20except%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20(None%2C%20pos%5Bi%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20arg2%20%3D%20stack.pop()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20arg1%20%3D%20stack.pop()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20except%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20(None%2C%20pos%5Bi%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20args%20%3D%20%5Barg1%2C%20arg2%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20stack.append(func(*args).astype(np.int32))%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20tok%20%3D%3D%20'%3F'%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pred%20%3D%20np.ones((64%2C))%20*%20stack.pop()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pred_true%20%3D%20np.ones((64%2C))%20*%20stack.pop()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pred_false%20%3D%20np.ones((64%2C))%20*%20stack.pop()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20except%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20(None%2C%20pos%5Bi%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20stack.append(np.where(pred%2C%20pred_true%2C%20pred_false))%0A%20%20%20%20%20%20%20%20return%20(stack%5B0%5D.astype(np.uint32)%2C%20None)%0A%20%20%20%20return%20(rp_eval%2C)%0A%0A%0A%40app.cell%0Adef%20_(__var_tokens__%2C%20np%2C%20rp_eval%2C%20shunt)%3A%0A%20%20%20%20_all_states%20%3D%20np.arange(64)%0A%20%20%20%20_all_bits%20%3D%20np.zeros((64%2C%206)%2C%20np.bool)%0A%20%20%20%20for%20i%20in%20range(6)%3A%0A%20%20%20%20%20%20%20%20_all_bits%5B%3A%2C%20i%5D%20%3D%20_all_states%20%26%202**(5-i)%20%3E%200%0A%20%20%20%20__vars__%20%3D%20%7Bvar%3A%20_all_bits%5B%3A%2C%20i%5D%20for%20i%2C%20var%20in%20enumerate(__var_tokens__)%7D%0A%0A%20%20%20%20def%20build_rule(infix_rule)%3A%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20rp_toks%2C%20err%20%3D%20shunt(infix_rule)%0A%20%20%20%20%20%20%20%20except%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20(%5B%5D%2C%200)%0A%20%20%20%20%20%20%20%20if%20not%20err%20is%20None%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20(%5B%5D%2C%20err)%0A%20%20%20%20%20%20%20%20toks%2C%20pos%20%3D%20zip(*rp_toks)%0A%20%20%20%20%20%20%20%20rp_rule%20%3D%20''.join(toks)%0A%20%20%20%20%20%20%20%20return%20rp_eval(rp_rule%2C%20pos%2C%20__vars__)%0A%20%20%20%20return%20(build_rule%2C)%0A%0A%0A%40app.cell%0Adef%20_(np%2C%20reduce)%3A%0A%20%20%20%20__shifts__%20%3D%20((16%2C%20-2)%2C%20(8%2C%20-1)%2C%20(2%2C%201)%2C%20(1%2C%202))%0A%0A%20%20%20%20def%20ca_step(rule%2C%20cells)%3A%0A%20%20%20%20%20%20%20%20lsb%20%3D%20cells%20%26%201%0A%20%20%20%20%20%20%20%20state_bits%20%3D%20(factor%20*%20np.roll(lsb%2C%20shift)%20for%20factor%2C%20shift%20in%20__shifts__)%0A%20%20%20%20%20%20%20%20states%20%3D%20reduce(np.add%2C%20state_bits%2C%204%20*%20lsb)%20%2B%2032%20*%20((cells%20%3E%3E%201)%20%26%201)%0A%20%20%20%20%20%20%20%20return%20rule%5Bstates%5D%0A%20%20%20%20return%20(ca_step%2C)%0A%0A%0A%40app.cell%0Adef%20_(ca_step%2C%20colormaps%2C%20np%2C%20partial)%3A%0A%20%20%20%20def%20mono_render(cells)%3A%0A%20%20%20%20%20%20%20%20return%20255%20-%20255%20*%20(cells%20%26%201)%0A%0A%20%20%20%20def%20palette_render(cells%2C%20cmap%2C%20mask)%3A%0A%20%20%20%20%20%20%20%20return%20(255%20*%20cmap((mask%20-%20(cells%20%26%20mask))%20%2F%20mask)%5B%3A%2C%200%2C%20%3A-1%5D).astype(np.uint8)%0A%0A%0A%20%20%20%20def%20ca_seq(rule%2C%20seed%2C%20height%2C%20history%3D0%2C%20palette%3D'YlGn'%2C%20frames%3D1)%3A%0A%20%20%20%20%20%20%20%20cells%20%3D%20np.ndarray.copy(seed)%0A%20%20%20%20%20%20%20%20width%2C%20_%20%3D%20cells.shape%0A%20%20%20%20%20%20%20%20if%20not%20history%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20renderer%20%3D%20mono_render%0A%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20renderer%20%3D%20partial(palette_render%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cmap%3Dcolormaps.get_cmap(palette)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mask%3D2**(history%2B1)%20-%201%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20for%20_%20in%20range(frames)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20img%20%3D%20np.zeros((height%2C%20width%2C%203)%2C%20np.uint8)%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20i%2C%20row%20in%20enumerate(img)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20img%5Bi%2C%20%3A%2C%20%3A%5D%20%3D%20renderer(cells)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cells%20%3D%20(cells%20%3C%3C%201)%20%2B%20(ca_step(rule%2C%20cells)%20%26%201)%0A%20%20%20%20%20%20%20%20%20%20%20%20yield%20img%0A%20%20%20%20return%20(ca_seq%2C)%0A%0A%0A%40app.cell%0Adef%20_(Image%2C%20build_rule%2C%20ca_seq%2C%20np)%3A%0A%20%20%20%20def%20ca1d_img(expr%2C%20width%2C%20height%2C%20history%3D0%2C%20palette%3D'YlGn'%2C%20max_dim%3D512)%3A%0A%20%20%20%20%20%20%20%20rule%2C%20err%20%3D%20build_rule(expr)%0A%20%20%20%20%20%20%20%20if%20not%20err%20is%20None%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20(Image.fromarray(np.zeros((max_dim%2C%20max_dim%2C%203)%2C%20np.uint8))%2C%20err)%0A%20%20%20%20%20%20%20%20cells%20%3D%20np.zeros((width%2C%201)%2C%20np.int32)%0A%20%20%20%20%20%20%20%20cells%5Bwidth%2F%2F2%5D%20%3D%201%0A%20%20%20%20%20%20%20%20img%20%3D%20ca_seq(rule%2C%20cells%2C%20height%2C%20history%2C%20palette).__next__()%0A%20%20%20%20%20%20%20%20mag%20%3D%20max_dim%20%2F%2F%20max(width%2C%20height)%0A%20%20%20%20%20%20%20%20return%20(Image.fromarray(img).resize((mag*width%2C%20mag*height)%2C%200)%2C%20None)%0A%20%20%20%20return%20(ca1d_img%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20cmap_names%20%3D%20%5B%0A%20%20%20%20%20%20%20%20'binary'%2C%20'gray'%2C%20'bone'%2C%20'seismic'%2C%20'vanimo'%2C%20'managua'%2C%20'berlin'%2C%20'Spectral'%2C%0A%20%20%20%20%20%20%20%20'twilight'%2C%20'twilight_shifted'%2C%20'ocean'%2C%20'turbo'%2C%20'plasma'%2C%20'magma'%2C%20'inferno'%2C%20'brg'%2C%20'gnuplot'%2C%0A%20%20%20%20%20%20%20%20'terrain'%2C%20'gist_earth'%0A%20%20%20%20%5D%0A%20%20%20%20return%20(cmap_names%2C)%0A%0A%0A%40app.cell%0Adef%20_(cmap_names%2C%20colormaps%2C%20mo)%3A%0A%20%20%20%20rule_box%20%3D%20mo.ui.text('(l%5ER)%7C(c%5EL)'%2C%20label%3D'rule')%0A%20%20%20%20hist_dropdown%20%3D%20mo.ui.dropdown(list(range(8))%2C%20value%3D4%2C%20label%3D'history')%0A%20%20%20%20dims%20%3D%20list(map(lambda%20n%3A%202**n%2C%20range(5%2C%2010)))%0A%20%20%20%20width_dropdown%20%3D%20mo.ui.dropdown(dims%2C%20value%3D512%2C%20label%3D'width')%0A%20%20%20%20height_dropdown%20%3D%20mo.ui.dropdown(dims%2C%20value%3D512%2C%20label%3D'height')%0A%20%20%20%20palettes%20%3D%20%5Bname%20for%20name%20in%20cmap_names%20if%20name%20in%20colormaps%5D%0A%20%20%20%20colour_box%20%3D%20mo.ui.dropdown(palettes%2C%20value%3D'twilight'%2C%20label%3D'palette')%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20colour_box%2C%0A%20%20%20%20%20%20%20%20dims%2C%0A%20%20%20%20%20%20%20%20height_dropdown%2C%0A%20%20%20%20%20%20%20%20hist_dropdown%2C%0A%20%20%20%20%20%20%20%20rule_box%2C%0A%20%20%20%20%20%20%20%20width_dropdown%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20ca1d_img%2C%0A%20%20%20%20colour_box%2C%0A%20%20%20%20dims%2C%0A%20%20%20%20height_dropdown%2C%0A%20%20%20%20hist_dropdown%2C%0A%20%20%20%20rule_box%2C%0A%20%20%20%20width_dropdown%2C%0A)%3A%0A%20%20%20%20ui_img%2C%20rule_err%20%3D%20ca1d_img(rule_box.value%2C%20width_dropdown.value%2C%20height_dropdown.value%2C%0A%20%20%20%20%20%20%20%20history%3Dhist_dropdown.value%2C%20palette%3Dcolour_box.value%2C%20max_dim%3Ddims%5B-1%5D%0A%20%20%20%20)%0A%20%20%20%20return%20rule_err%2C%20ui_img%0A%0A%0A%40app.cell%0Adef%20_(rule_box%2C%20rule_err)%3A%0A%20%20%20%20if%20rule_err%20is%20None%3A%0A%20%20%20%20%20%20%20%20err_txt%20%3D%20''%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20err_txt%20%3D%20'%5Cn'.join(%5Brule_box.value%2C%20'%20'*rule_err%2B'%5E'%5D)%0A%20%20%20%20return%20(err_txt%2C)%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20colour_box%2C%0A%20%20%20%20err_txt%2C%0A%20%20%20%20height_dropdown%2C%0A%20%20%20%20hist_dropdown%2C%0A%20%20%20%20mo%2C%0A%20%20%20%20rule_box%2C%0A%20%20%20%20ui_img%2C%0A%20%20%20%20width_dropdown%2C%0A)%3A%0A%20%20%20%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20mo.hstack(%5Brule_box%2C%20mo.plain_text(err_txt)%5D)%2C%0A%20%20%20%20%20%20%20%20mo.hstack(%5Bhist_dropdown%2C%20width_dropdown%2C%20height_dropdown%2C%20colour_box%5D%2C%20justify%3D'center')%2C%0A%20%20%20%20%20%20%20%20ui_img%2C%0A%20%20%20%20%5D%2C%20align%3D'center')%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23Rule%20Syntax%0A%0A%20%20%20%20%20%20%20%20Each%20token%20in%20a%20rule%20is%20a%20single%20character%3A%0A%0A%20%20%20%20%20%20%20%20*%20variables%3A%20spatial%2C%20%60L%60%2C%20%60l%60%2C%20%60c%60%2C%20%60r%60%2C%20%60R%60%20and%20%60p%60%20(previous)%2C%200%20or%201%0A%20%20%20%20%20%20%20%20*%20constants%3A%20single%20digits%200-9%0A%20%20%20%20%20%20%20%20*%20integer%20operators%3A%20%60%2B%60%2C%20%60-%60%2C%20%60*%60%2C%20%60%25%60%20(modular%20division)%0A%20%20%20%20%20%20%20%20*%20boolean%20operators%3A%20%60%26%60%2C%20(and)%20%60%7C%60%2C%20(or)%20%60%5E%60%2C%20(xor)%20%60%3C%60%2C%20%60%3D%60%2C%20%60%3E%60%0A%20%20%20%20%20%20%20%20*%20parentheses%3A%20%60()%60%0A%20%20%20%20%20%20%20%20*%20predicate%20function%3A%20%60%3F%60%20(%60%3F(predicate%2C%20expression-if-true%2C%20expression-if-false)%60)%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(ca1d_img%2C%20cmap_names%2C%20mo)%3A%0A%20%20%20%20def%20eg_img(rule%2C%20size%3D128%2C%20palette%3Dcmap_names%5B0%5D%2C%20history%3D3)%3A%0A%20%20%20%20%20%20%20%20return%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.plain_text(rule)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20ca1d_img(rule%2C%20size%2C%20size%2C%20max_dim%3Dsize%2C%20palette%3Dpalette%2C%20history%3Dhistory)%5B0%5D%0A%20%20%20%20%20%20%20%20%5D%2C%20heights%3D%5B0%2C0%5D)%0A%0A%20%20%20%20return%20(eg_img%2C)%0A%0A%0A%40app.cell%0Adef%20_(eg_img%2C%20mo)%3A%0A%20%20%20%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20mo.plain_text('Some%20example%20rules%3A')%2C%0A%20%20%20%20%20%20%20%20mo.hstack(%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20eg_img('(L%5Ec)%7C(r%5Ec)'%2C%20palette%3D'plasma')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20eg_img('((l%2Br)%3E(L%2BR%2Bc))%5E(L%26R)'%2C%20palette%3D'ocean')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20eg_img('(l%7CL)%5E((L%7CR)%5Ep)'%2C%20palette%3D'seismic')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20eg_img('((l%5ER)%7C(R%5Ep))'%2C%20palette%3D'turbo')%0A%20%20%20%20%20%20%20%20%5D)%2C%0A%20%20%20%20%20%20%20%20mo.hstack(%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20eg_img('((l%5Ep)%7C(L%5Ec))'%2C%20palette%3D'magma')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20eg_img('(l%5EL)%7C(c%5ER)'%2C%20palette%3D'gray')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20eg_img('l%5E(c%7Cr)'%2C%20palette%3D'ocean')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20eg_img('(c%2Br%2Bc*r%2Bl*c*r)%252'%2C%20palette%3D'brg')%0A%20%20%20%20%20%20%20%20%5D)%0A%20%20%20%20%5D)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22(The%20last%20two%20are%20the%20moderately%20infamous%20%5Brule%2030%5D(https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FRule_30))%20and%20%5Brule%20110%5D(https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FElementary_cellular_automaton).)%22%22%22)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
  </body>
</html>
